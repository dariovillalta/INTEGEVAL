{"version":3,"sources":["components/Graficos/PieGraph.js"],"names":["c3","require","d3","resultados","PieGraph","props","getLabels","bind","getSumValues","insertIntoResults","renderChart","nombreIdentificador","tablaEtiqueta","localeCompare","transaction","sql","Transaction","pool","begin","err","rolledBack","on","aborted","request","Request","query","nombreEtiqueta","result","console","log","rollback","commit","i","recordset","length","identificador","idObjeto","valor","tablaNumerico","nombreNumerico","entro","getTime","push","chartClientes","generate","bindto","data","columns","type","colors","data1","data2","data3","data4","data5","pie","label","format","value","ratio","id","React","Component"],"mappings":";;;;;;;AAAA;;AACA;;;;;;;;;;;;;;;;;;;;;;AAEA,IAAIA,EAAE,GAAGC,OAAO,CAAC,IAAD,CAAhB;;AACA,IAAIC,EAAE,GAAGD,OAAO,CAAC,IAAD,CAAhB;;AAEA,IAAIE,UAAU,GAAG,EAAjB;;IAEqBC,Q;;;;;AACjB,oBAAYC,KAAZ,EAAmB;AAAA;;AAAA;;AACf,kFAAMA,KAAN;AACA,UAAKC,SAAL,GAAiB,MAAKA,SAAL,CAAeC,IAAf,+BAAjB;AACA,UAAKC,YAAL,GAAoB,MAAKA,YAAL,CAAkBD,IAAlB,+BAApB;AACA,UAAKE,iBAAL,GAAyB,MAAKA,iBAAL,CAAuBF,IAAvB,+BAAzB;AACA,UAAKG,WAAL,GAAmB,MAAKA,WAAL,CAAiBH,IAAjB,+BAAnB;AALe;AAMlB;;;;wCAEmB;AAChBJ,MAAAA,UAAU,GAAG,EAAb;AACA,WAAKG,SAAL;AACH;;;gCAEY;AAAA;;AACT,UAAIK,mBAAmB,GAAG,iBAA1B;AACA,UAAG,KAAKN,KAAL,CAAWO,aAAX,CAAyBC,aAAzB,CAAuC,cAAvC,KAA0D,CAA7D,EACIF,mBAAmB,GAAG,eAAtB;AACJ,UAAMG,WAAW,GAAG,IAAIC,kBAAIC,WAAR,CAAqB,KAAKX,KAAL,CAAWY,IAAhC,CAApB;AACAH,MAAAA,WAAW,CAACI,KAAZ,CAAkB,UAAAC,GAAG,EAAI;AACrB,YAAIC,UAAU,GAAG,KAAjB;AACAN,QAAAA,WAAW,CAACO,EAAZ,CAAe,UAAf,EAA2B,UAAAC,OAAO,EAAI;AAClCF,UAAAA,UAAU,GAAG,IAAb;AACH,SAFD;AAGA,YAAMG,OAAO,GAAG,IAAIR,kBAAIS,OAAR,CAAgBV,WAAhB,CAAhB;AACAS,QAAAA,OAAO,CAACE,KAAR,CAAc,YAAUd,mBAAV,GAA8B,QAA9B,GAAuC,MAAI,CAACN,KAAL,CAAWO,aAAlD,GAAgE,mBAAhE,GAAoF,MAAI,CAACP,KAAL,CAAWqB,cAA/F,GAA8G,GAA5H,EAAiI,UAACP,GAAD,EAAMQ,MAAN,EAAiB;AAC9I,cAAIR,GAAJ,EAAS;AACL,gBAAI,CAACC,UAAL,EAAiB;AACbQ,cAAAA,OAAO,CAACC,GAAR,CAAYV,GAAZ;AACAL,cAAAA,WAAW,CAACgB,QAAZ,CAAqB,UAAAX,GAAG,EAAI,CAC3B,CADD;AAEH;AACJ,WAND,MAMO;AACHL,YAAAA,WAAW,CAACiB,MAAZ,CAAmB,UAAAZ,GAAG,EAAI;AACtB,mBAAK,IAAIa,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGL,MAAM,CAACM,SAAP,CAAiBC,MAArC,EAA6CF,CAAC,EAA9C,EAAkD;AAC9C,oBAAG,MAAI,CAAC3B,KAAL,CAAWO,aAAX,CAAyBC,aAAzB,CAAuC,cAAvC,KAA0D,CAA7D,EACI,MAAI,CAACL,YAAL,CAAkBmB,MAAM,CAACM,SAAP,CAAiBD,CAAjB,EAAoBG,aAAtC,EAAqDR,MAAM,CAACM,SAAP,CAAiBD,CAAjB,EAAoBG,aAAzE,EADJ,KAGI,MAAI,CAAC3B,YAAL,CAAkBmB,MAAM,CAACM,SAAP,CAAiBD,CAAjB,EAAoBI,QAAtC,EAAgDT,MAAM,CAACM,SAAP,CAAiBD,CAAjB,EAAoBK,KAApE;AACP;;AAAA;AACJ,aAPD;AAQH;AACJ,SAjBD;AAkBH,OAxBD,EALS,CA6BL;AACP;;;iCAEaD,Q,EAAUV,c,EAAgB;AAAA;;AACpC,UAAMZ,WAAW,GAAG,IAAIC,kBAAIC,WAAR,CAAqB,KAAKX,KAAL,CAAWY,IAAhC,CAApB;AACAH,MAAAA,WAAW,CAACI,KAAZ,CAAkB,UAAAC,GAAG,EAAI;AACrB,YAAIC,UAAU,GAAG,KAAjB;AACAN,QAAAA,WAAW,CAACO,EAAZ,CAAe,UAAf,EAA2B,UAAAC,OAAO,EAAI;AAClCF,UAAAA,UAAU,GAAG,IAAb;AACH,SAFD;AAGA,YAAMG,OAAO,GAAG,IAAIR,kBAAIS,OAAR,CAAgBV,WAAhB,CAAhB;AACAS,QAAAA,OAAO,CAACE,KAAR,CAAc,uBAAqB,MAAI,CAACpB,KAAL,CAAWiC,aAAhC,GAA8C,mBAA9C,GAAkE,MAAI,CAACjC,KAAL,CAAWkC,cAA7E,GAA4F,oBAA5F,GAAiHH,QAAjH,GAA0H,GAAxI,EAA6I,UAACjB,GAAD,EAAMQ,MAAN,EAAiB;AAC1J,cAAIR,GAAJ,EAAS;AACL,gBAAI,CAACC,UAAL,EAAiB;AACbQ,cAAAA,OAAO,CAACC,GAAR,CAAYV,GAAZ;AACAL,cAAAA,WAAW,CAACgB,QAAZ,CAAqB,UAAAX,GAAG,EAAI,CAC3B,CADD;AAEH;AACJ,WAND,MAMO;AACHL,YAAAA,WAAW,CAACiB,MAAZ,CAAmB,UAAAZ,GAAG,EAAI;AACtBS,cAAAA,OAAO,CAACC,GAAR,CAAYF,MAAM,CAACM,SAAnB;;AACA,mBAAK,IAAID,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGL,MAAM,CAACM,SAAP,CAAiBC,MAArC,EAA6CF,CAAC,EAA9C,EAAkD;AAC9C,gBAAA,MAAI,CAACvB,iBAAL,CAAuBkB,MAAM,CAACM,SAAP,CAAiBD,CAAjB,EAAoBK,KAA3C,EAAkDX,cAAlD;AACH;;AAAA;AACJ,aALD;AAMH;AACJ,SAfD;AAgBH,OAtBD,EAFoC,CAwBhC;AACP;;;sCAEkBW,K,EAAOX,c,EAAgB;AACtC,UAAIc,KAAK,GAAG,KAAZ;;AACA,WAAK,IAAIR,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG7B,UAAU,CAAC+B,MAA/B,EAAuCF,CAAC,EAAxC,EAA4C;AACxC,YAAG,KAAK3B,KAAL,CAAWO,aAAX,CAAyBC,aAAzB,CAAuC,kBAAvC,KAA8D,CAAjE,EAAoE;AAChE,cAAGV,UAAU,CAAC6B,CAAD,CAAV,CAAc,CAAd,EAAiBnB,aAAjB,CAA+Ba,cAA/B,KAAkD,CAArD,EAAwD;AACpDvB,YAAAA,UAAU,CAAC6B,CAAD,CAAV,CAAc,CAAd,KAAoBK,KAApB;AACAG,YAAAA,KAAK,GAAG,IAAR;AACA;AACH;AACJ,SAND,MAMO,IAAG,KAAKnC,KAAL,CAAWO,aAAX,CAAyBC,aAAzB,CAAuC,gBAAvC,KAA4D,CAA/D,EAAkE;AACrE,cAAGV,UAAU,CAAC6B,CAAD,CAAV,CAAc,CAAd,KAAoBN,cAAvB,EAAuC;AACnCvB,YAAAA,UAAU,CAAC6B,CAAD,CAAV,CAAc,CAAd,KAAoBK,KAApB;AACAG,YAAAA,KAAK,GAAG,IAAR;AACA;AACH;AACJ,SANM,MAMA,IAAG,KAAKnC,KAAL,CAAWO,aAAX,CAAyBC,aAAzB,CAAuC,gBAAvC,KAA4D,CAA/D,EAAkE;AACrE,cAAGV,UAAU,CAAC6B,CAAD,CAAV,CAAc,CAAd,EAAiBS,OAAjB,MAA8Bf,cAAc,CAACe,OAAf,EAAjC,EAA2D;AACvDtC,YAAAA,UAAU,CAAC6B,CAAD,CAAV,CAAc,CAAd,KAAoBK,KAApB;AACAG,YAAAA,KAAK,GAAG,IAAR;AACA;AACH;AACJ,SANM,MAMA,IAAG,KAAKnC,KAAL,CAAWO,aAAX,CAAyBC,aAAzB,CAAuC,cAAvC,KAA0D,CAA7D,EAAgE;AACnE,cAAGV,UAAU,CAAC6B,CAAD,CAAV,CAAc,CAAd,KAAoBN,cAAvB,EAAuC;AACnCvB,YAAAA,UAAU,CAAC6B,CAAD,CAAV,CAAc,CAAd,KAAoBK,KAApB;AACAG,YAAAA,KAAK,GAAG,IAAR;AACA;AACH;AACJ;AACJ;;AAAA;;AACD,UAAGrC,UAAU,CAAC+B,MAAX,IAAqB,CAArB,IAA0B,CAACM,KAA9B,EAAqC;AACjCrC,QAAAA,UAAU,CAACuC,IAAX,CAAgB,CAAChB,cAAD,EAAiBW,KAAjB,CAAhB;AACH;;AACDT,MAAAA,OAAO,CAACC,GAAR,CAAY1B,UAAZ;AACA,WAAKO,WAAL;AACH;;;kCAEc;AACX,UAAIiC,aAAa,GAAG3C,EAAE,CAAC4C,QAAH,CAAY;AAC5BC,QAAAA,MAAM,EAAE,YADoB;AAE5BC,QAAAA,IAAI,EAAE;AACFC,UAAAA,OAAO,EAAE5C,UADP;AAEF6C,UAAAA,IAAI,EAAE,KAFJ;AAIFC,UAAAA,MAAM,EAAE;AACJC,YAAAA,KAAK,EAAE,SADH;AAEJC,YAAAA,KAAK,EAAE,SAFH;AAGJC,YAAAA,KAAK,EAAE,SAHH;AAIJC,YAAAA,KAAK,EAAE,SAJH;AAKJC,YAAAA,KAAK,EAAE;AALH;AAJN,SAFsB;AAe5BC,QAAAA,GAAG,EAAE;AACDC,UAAAA,KAAK,EAAE;AACHC,YAAAA,MAAM,EAAE,gBAASC,KAAT,EAAgBC,KAAhB,EAAuBC,EAAvB,EAA2B;AAC/B,qBAAO1D,EAAE,CAACuD,MAAH,CAAU,GAAV,EAAeC,KAAf,CAAP;AACH;AAHE;AADN;AAfuB,OAAZ,CAApB;AAuBH;;;6BAEQ;AACL,aACI;AAAK,QAAA,SAAS,EAAC;AAAf,SACI;AAAK,QAAA,SAAS,EAAC;AAAf,SACI;AAAK,QAAA,SAAS,EAAC;AAAf,SACI;AAAI,QAAA,SAAS,EAAC;AAAd,sBADJ,EAEI;AAAK,QAAA,SAAS,EAAC;AAAf,SACI;AAAK,QAAA,EAAE,EAAC;AAAR,QADJ,CAFJ,CADJ,CADJ,CADJ;AAYH;;;;EApJiCG,kBAAMC,S","sourcesContent":["import React from 'react';\nimport sql from 'mssql';\n\nvar c3 = require(\"c3\");\nvar d3 = require(\"d3\");\n\nvar resultados = [];\n\nexport default class PieGraph extends React.Component {\n    constructor(props) {\n        super(props);\n        this.getLabels = this.getLabels.bind(this);\n        this.getSumValues = this.getSumValues.bind(this);\n        this.insertIntoResults = this.insertIntoResults.bind(this);\n        this.renderChart = this.renderChart.bind(this);\n    }\n\n    componentDidMount() {\n        resultados = [];\n        this.getLabels();\n    }\n\n    getLabels () {\n        var nombreIdentificador = \"valor, idObjeto\";\n        if(this.props.tablaEtiqueta.localeCompare(\"ResultadosID\") == 0)\n            nombreIdentificador = \"identificador\";\n        const transaction = new sql.Transaction( this.props.pool );\n        transaction.begin(err => {\n            var rolledBack = false;\n            transaction.on('rollback', aborted => {\n                rolledBack = true;\n            });\n            const request = new sql.Request(transaction);\n            request.query(\"select \"+nombreIdentificador+\" from \"+this.props.tablaEtiqueta+\" where nombre = '\"+this.props.nombreEtiqueta+\"'\", (err, result) => {\n                if (err) {\n                    if (!rolledBack) {\n                        console.log(err);\n                        transaction.rollback(err => {\n                        });\n                    }\n                } else {\n                    transaction.commit(err => {\n                        for (var i = 0; i < result.recordset.length; i++) {\n                            if(this.props.tablaEtiqueta.localeCompare(\"ResultadosID\") == 0)\n                                this.getSumValues(result.recordset[i].identificador, result.recordset[i].identificador);\n                            else\n                                this.getSumValues(result.recordset[i].idObjeto, result.recordset[i].valor);\n                        };\n                    });\n                }\n            });\n        }); // fin transaction\n    }\n\n    getSumValues (idObjeto, nombreEtiqueta) {\n        const transaction = new sql.Transaction( this.props.pool );\n        transaction.begin(err => {\n            var rolledBack = false;\n            transaction.on('rollback', aborted => {\n                rolledBack = true;\n            });\n            const request = new sql.Request(transaction);\n            request.query(\"select valor from \"+this.props.tablaNumerico+\" where nombre = '\"+this.props.nombreNumerico+\"' and idObjeto = '\"+idObjeto+\"'\", (err, result) => {\n                if (err) {\n                    if (!rolledBack) {\n                        console.log(err);\n                        transaction.rollback(err => {\n                        });\n                    }\n                } else {\n                    transaction.commit(err => {\n                        console.log(result.recordset);\n                        for (var i = 0; i < result.recordset.length; i++) {\n                            this.insertIntoResults(result.recordset[i].valor, nombreEtiqueta);\n                        };\n                    });\n                }\n            });\n        }); // fin transaction\n    }\n\n    insertIntoResults (valor, nombreEtiqueta) {\n        var entro = false;\n        for (var i = 0; i < resultados.length; i++) {\n            if(this.props.tablaEtiqueta.localeCompare(\"ResultadosString\") == 0) {\n                if(resultados[i][0].localeCompare(nombreEtiqueta) == 0) {\n                    resultados[i][1] += valor;\n                    entro = true;\n                    break;\n                }\n            } else if(this.props.tablaEtiqueta.localeCompare(\"ResultadosBool\") == 0) {\n                if(resultados[i][0] == nombreEtiqueta) {\n                    resultados[i][1] += valor;\n                    entro = true;\n                    break;\n                }\n            } else if(this.props.tablaEtiqueta.localeCompare(\"ResultadosDate\") == 0) {\n                if(resultados[i][0].getTime() == nombreEtiqueta.getTime()) {\n                    resultados[i][1] += valor;\n                    entro = true;\n                    break;\n                }\n            } else if(this.props.tablaEtiqueta.localeCompare(\"ResultadosID\") == 0) {\n                if(resultados[i][0] == nombreEtiqueta) {\n                    resultados[i][1] += valor;\n                    entro = true;\n                    break;\n                }\n            }\n        };\n        if(resultados.length == 0 || !entro) {\n            resultados.push([nombreEtiqueta, valor])\n        }\n        console.log(resultados);\n        this.renderChart();\n    }\n\n    renderChart () {\n        var chartClientes = c3.generate({\n            bindto: \"#resultado\",\n            data: {\n                columns: resultados,\n                type: 'pie',\n\n                colors: {\n                    data1: '#5969ff',\n                    data2: '#ff407b',\n                    data3: '#b39ddb',\n                    data4: '#80deea',\n                    data5: '#ffcc80'\n\n                }\n            },\n            pie: {\n                label: {\n                    format: function(value, ratio, id) {\n                        return d3.format('$')(value);\n                    }\n                }\n            }\n        });\n    }\n\n    render() {\n        return (\n            <div className=\"row\">\n                <div className=\"col-xl-12 col-12\">\n                    <div className=\"card\">\n                        <h5 className=\"card-header\">Gráfico</h5>\n                        <div className=\"card-body\">\n                            <div id=\"resultado\"></div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        );\n    }\n}\n"],"file":"PieGraph.js"}