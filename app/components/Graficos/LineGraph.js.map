{"version":3,"sources":["components/Graficos/LineGraph.js"],"names":["c3","require","d3","resultados","fechas","seCreo","chart","LineGraph","props","getLabels","bind","getSumValues","insertIntoResults","renderChart","nombreIdentificador","tablaEtiqueta","localeCompare","transaction","sql","Transaction","pool","begin","err","rolledBack","on","aborted","request","Request","query","nombreEtiqueta","result","console","log","rollback","commit","i","recordset","length","identificador","idObjeto","valor","tablaNumerico","nombreNumerico","fecha","entro","entroFecha","posicionFecha","getFullYear","getMonth","getDate","push","undefined","getTime","generate","bindto","data","columns","axis","x","type","categories","load","React","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport sql from 'mssql';\n\nvar c3 = require(\"c3\");\nvar d3 = require(\"d3\");\n\nvar resultados = [];\nvar fechas = [];\nvar seCreo = false;\nvar chart;\n\nexport default class LineGraph extends React.Component {\n    constructor(props) {\n        super(props);\n        this.getLabels = this.getLabels.bind(this);\n        this.getSumValues = this.getSumValues.bind(this);\n        this.insertIntoResults = this.insertIntoResults.bind(this);\n        this.renderChart = this.renderChart.bind(this);\n    }\n\n    componentDidMount() {\n        resultados = [];\n        this.getLabels();\n    }\n\n    getLabels () {\n        var nombreIdentificador = \"valor, idObjeto\";\n        if(this.props.tablaEtiqueta.localeCompare(\"ResultadosID\") == 0)\n            nombreIdentificador = \"identificador\";\n        const transaction = new sql.Transaction( this.props.pool );\n        transaction.begin(err => {\n            var rolledBack = false;\n            transaction.on('rollback', aborted => {\n                rolledBack = true;\n            });\n            const request = new sql.Request(transaction);\n            request.query(\"select \"+nombreIdentificador+\" from \"+this.props.tablaEtiqueta+\" where nombre = '\"+this.props.nombreEtiqueta+\"'\", (err, result) => {\n                if (err) {\n                    if (!rolledBack) {\n                        console.log(err);\n                        transaction.rollback(err => {\n                        });\n                    }\n                } else {\n                    transaction.commit(err => {\n                        for (var i = 0; i < result.recordset.length; i++) {\n                            if(this.props.tablaEtiqueta.localeCompare(\"ResultadosID\") == 0)\n                                this.getSumValues(result.recordset[i].identificador, result.recordset[i].identificador);\n                            else\n                                this.getSumValues(result.recordset[i].idObjeto, result.recordset[i].valor);\n                        };\n                    });\n                }\n            });\n        }); // fin transaction\n    }\n\n    getSumValues (idObjeto, nombreEtiqueta) {\n        const transaction = new sql.Transaction( this.props.pool );\n        transaction.begin(err => {\n            var rolledBack = false;\n            transaction.on('rollback', aborted => {\n                rolledBack = true;\n            });\n            const request = new sql.Request(transaction);\n            request.query(\"select valor, fecha from \"+this.props.tablaNumerico+\" where nombre = '\"+this.props.nombreNumerico+\"' and idObjeto = '\"+idObjeto+\"'\", (err, result) => {\n                if (err) {\n                    if (!rolledBack) {\n                        console.log(err);\n                        transaction.rollback(err => {\n                        });\n                    }\n                } else {\n                    transaction.commit(err => {\n                        console.log(result.recordset);\n                        for (var i = 0; i < result.recordset.length; i++) {\n                            this.insertIntoResults(result.recordset[i].valor, result.recordset[i].fecha, nombreEtiqueta);\n                        };\n                    });\n                }\n            });\n        }); // fin transaction\n    }\n\n    insertIntoResults (valor, fecha, nombreEtiqueta) {\n        var entro = false;\n        var entroFecha = false;\n        var posicionFecha = 1;\n        for (var i = 0; i < fechas.length; i++) {\n            if((fechas[i].getFullYear() == fecha.getFullYear() && fechas[i].getMonth() == fecha.getMonth() && fechas[i].getDate() == fecha.getDate())) {\n                posicionFecha = i+1;\n                entroFecha = true;\n            }\n        };\n        if(fechas.length == 0 || !entroFecha) {\n            fechas.push(fecha);\n        }\n        for (var i = 0; i < resultados.length; i++) {\n            if(this.props.tablaEtiqueta.localeCompare(\"ResultadosString\") == 0) {\n                if(resultados[i][0].localeCompare(nombreEtiqueta) == 0) {\n                    if(resultados[i][posicionFecha] == undefined)\n                        resultados[i][posicionFecha] = 0\n                    resultados[i][posicionFecha] += valor;\n                    entro = true;\n                    break;\n                }\n            } else if(this.props.tablaEtiqueta.localeCompare(\"ResultadosBool\") == 0) {\n                if(resultados[i][0] == nombreEtiqueta) {\n                    if(resultados[i][posicionFecha] == undefined)\n                        resultados[i][posicionFecha] = 0\n                    resultados[i][posicionFecha] += valor;\n                    entro = true;\n                    break;\n                }\n            } else if(this.props.tablaEtiqueta.localeCompare(\"ResultadosDate\") == 0) {\n                if(resultados[i][0].getTime() == nombreEtiqueta.getTime()) {\n                    if(resultados[i][posicionFecha] == undefined)\n                        resultados[i][posicionFecha] = 0\n                    resultados[i][posicionFecha] += valor;\n                    entro = true;\n                    break;\n                }\n            } else if(this.props.tablaEtiqueta.localeCompare(\"ResultadosID\") == 0) {\n                if(resultados[i][0] == nombreEtiqueta) {\n                    if(resultados[i][posicionFecha] == undefined)\n                        resultados[i][posicionFecha] = 0\n                    resultados[i][posicionFecha] += valor;\n                    entro = true;\n                    break;\n                }\n            }\n        };\n        if(resultados.length == 0 || !entro) {\n            resultados.push([nombreEtiqueta, valor]);\n        }\n        console.log(resultados);\n        console.log(fechas);\n        this.renderChart();\n    }\n\n    renderChart () {\n        if(!seCreo) {\n            chart = c3.generate({\n                bindto: \"#resultado\",\n                data: {\n                    columns: resultados\n                },\n                axis: {\n                    x: {\n                        type: 'category',\n                        categories: fechas\n                    }\n                }\n            });\n        } else {\n            chart.load({\n                columns: [\n                    resultados\n                ]\n            });\n            chart.axis.x({type: 'category', categories: fechas});\n        }\n    }\n\n    render() {\n        return (\n            <div className=\"row\">\n                <div className=\"col-xl-12 col-12\">\n                    <div className=\"card\">\n                        <h5 className=\"card-header\">Gráfico</h5>\n                        <div className=\"card-body\">\n                            <div id=\"resultado\"></div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        );\n    }\n}\n"],"file":"LineGraph.js"}