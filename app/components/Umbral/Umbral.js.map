{"version":3,"sources":["components/Umbral/Umbral.js"],"names":["secciones","nombre","color","width","seccionesConRango","posicionesInsertadasRango","posicionesAInsertarRango","Umbral","props","state","umbrales","traerUmbrales","bind","inicioTraerSecciones","traerSeccion","inicioTraerSeccionRango","traerSeccionRango","inicioCrearArregloSeccionRango","ingresarSeccion","console","log","navbar","transaction","sql","Transaction","pool","begin","err","rolledBack","on","aborted","request","Request","query","idVariable","result","rollback","commit","setState","recordset","posicionesInsertadas","i","length","umbral","index","ultimoIndex","ID","undefined","push","j","seccionRango","indexUmbral","indexRango","rangos","arrOrdenado","k","sumTot","totSec","valorMaximo","valorMinimo","seccionNueva","arrSecciones","encontroPos","splice","React","Component"],"mappings":"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","sourcesContent":["import React from 'react';\n\nimport VistaUmbral from './VistaUmbral.js';\nimport UmbralOpciones from './UmbralOpciones.js';\n\nconst secciones = [{nombre: \"MONO 1\", color: \"#00c853\", width: \"25%\"}, {nombre: \"MONO 2\", color: \"#ffab40\", width: \"50%\"}, {nombre: \"MONO 1\", color: \"#00c853\", width: \"25%\"}];\nvar seccionesConRango = [];\nvar posicionesInsertadasRango = 0, posicionesAInsertarRango = 0;\n\nexport default class Umbral extends React.Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            umbrales: [],\n            secciones: []\n        }\n        this.traerUmbrales = this.traerUmbrales.bind(this);\n        this.inicioTraerSecciones = this.inicioTraerSecciones.bind(this);\n        this.traerSeccion = this.traerSeccion.bind(this);\n        this.inicioTraerSeccionRango = this.inicioTraerSeccionRango.bind(this);\n        this.traerSeccionRango = this.traerSeccionRango.bind(this);\n        this.inicioCrearArregloSeccionRango = this.inicioCrearArregloSeccionRango.bind(this);\n        this.ingresarSeccion = this.ingresarSeccion.bind(this);\n        console.log(this.props.navbar)\n    }\n\n    componentDidMount() {\n        this.traerUmbrales();\n    }\n\n    traerUmbrales () {\n        const transaction = new sql.Transaction( this.props.pool );\n        transaction.begin(err => {\n            var rolledBack = false;\n            transaction.on('rollback', aborted => {\n                rolledBack = true;\n            });\n            const request = new sql.Request(transaction);\n            request.query(\"select * from Umbral where variableID = \"+this.props.idVariable, (err, result) => {\n                if (err) {\n                    if (!rolledBack) {\n                        console.log(err);\n                        transaction.rollback(err => {\n                        });\n                    }\n                } else {\n                    transaction.commit(err => {\n                        this.setState({\n                            umbrales: result.recordset\n                        }, this.inicioTraerSecciones );\n                    });\n                }\n            });\n        }); // fin transaction\n    }\n\n    inicioTraerSecciones () {\n        var posicionesInsertadas = [];\n        seccionesConRango = [];\n        for (var i = 0; i < this.state.umbrales.length; i++) {\n            this.traerSeccion(this.state.umbrales[i], i, this.state.umbrales.length, posicionesInsertadas);\n        };\n    }\n\n    traerSeccion (umbral, index, ultimoIndex, posicionesInsertadas) {\n        const transaction = new sql.Transaction( this.props.pool );\n        transaction.begin(err => {\n            var rolledBack = false;\n            transaction.on('rollback', aborted => {\n                rolledBack = true;\n            });\n            const request = new sql.Request(transaction);\n            request.query(\"select * from SeccionUmbral where umbralID = \"+umbral.ID, (err, result) => {\n                if (err) {\n                    if (!rolledBack) {\n                        console.log(err);\n                        transaction.rollback(err => {\n                        });\n                    }\n                } else {\n                    transaction.commit(err => {\n                        if(seccionesConRango[index] == undefined)\n                            seccionesConRango[index] = [];\n                        seccionesConRango[index] = result.recordset;\n                        posicionesInsertadas.push(index);\n                        if(posicionesInsertadas.length == ultimoIndex)\n                            this.inicioTraerSeccionRango();\n                    });\n                }\n            });\n        }); // fin transaction\n    }\n\n    inicioTraerSeccionRango () {\n        posicionesInsertadasRango = 0, posicionesAInsertarRango = 0;\n        for (var i = 0; i < seccionesConRango.length; i++) {\n            for (var j = 0; j < seccionesConRango[i].length; j++) {\n                posicionesAInsertarRango++;\n                this.traerSeccionRango(seccionesConRango[i][j]);\n            };\n        };\n    }\n\n    traerSeccionRango (seccionRango, indexUmbral, indexRango) {\n        const transaction = new sql.Transaction( this.props.pool );\n        transaction.begin(err => {\n            var rolledBack = false;\n            transaction.on('rollback', aborted => {\n                rolledBack = true;\n            });\n            const request = new sql.Request(transaction);\n            request.query(\"select * from RangoSeccionUmbral where variableID = \"+this.props.idVariable, (err, result) => {\n                if (err) {\n                    posicionesInsertadasRango++;\n                    console.log(err);\n                    if (!rolledBack) {\n                        transaction.rollback(err => {\n                        });\n                    }\n                } else {\n                    transaction.commit(err => {\n                        posicionesInsertadasRango++;\n                        if(seccionesConRango[indexUmbral] == undefined)\n                            seccionesConRango[indexUmbral] = [];\n                        if(seccionesConRango[indexUmbral][indexRango] == undefined)\n                            seccionesConRango[indexUmbral][indexRango] = [];\n                        seccionesConRango[indexUmbral][indexRango].rangos = result.recordset;\n                        if(posicionesInsertadasRango == posicionesAInsertarRango)\n                            this.inicioCrearArregloSeccionRango();\n                    });\n                }\n            });\n        }); // fin transaction\n    }\n\n    inicioCrearArregloSeccionRango () {\n        var arrOrdenado = [];\n        for (var i = 0; i < seccionesConRango.length; i++) {\n            for (var j = 0; j < seccionesConRango[i].length; j++) {\n                for (var k = 0; k < seccionesConRango[i][j].rangos.length; k++) {\n                    this.ingresarSeccion(seccionesConRango[i][j].rangos[k], arrOrdenado);\n                };\n            };\n        };\n        console.log('arrOrdenado');\n        console.log(arrOrdenado);\n        //calculando porcentaje dentro del total\n        //suma del total\n        var sumTot = 0;\n        for (var i = 0; i < arrOrdenado.length; i++) {\n            var totSec = arrOrdenado[i].valorMaximo - arrOrdenado[i].valorMinimo;\n            sumTot += totSec;\n        };\n        for (var i = 0; i < arrOrdenado.length; i++) {\n            var totSec = arrOrdenado[i].valorMaximo - arrOrdenado[i].valorMinimo;\n            arrOrdenado[i].valorMaximo.width = totSec / sumTot;\n        };\n    }\n\n    ingresarSeccion (seccionNueva, arrSecciones) {\n        if(arrSecciones.length == 0) {\n            arrSecciones.push(seccionNueva);\n            return;\n        }\n        var encontroPos = false;\n        for (var i = 0; i < arrSecciones.length; i++) {\n            if(seccionNueva.valorMaximo < arrSecciones[i].valorMinimo) {\n                encontroPos = true;\n                break;\n            }\n        };\n        arrSecciones.splice(i, 0, seccionNueva);\n    }\n\n    render() {\n        return (\n            <div>\n                {this.props.navbar}\n                <VistaUmbral umbrales={secciones}> </VistaUmbral>\n                <UmbralOpciones idVariable={this.props.idVariable} pool={this.props.pool}> </UmbralOpciones>\n            </div>\n        );\n    }\n}\n"],"file":"Umbral.js"}