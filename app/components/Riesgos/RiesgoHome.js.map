{"version":3,"sources":["components/Riesgos/RiesgoHome.js"],"names":["isMounted","RiesgoHome","props","state","riesgos","pesoDisponible","idRiesgoSeleccionado","componenteActual","getRiesgos","bind","acutalizarPesoMaximoDisponible","crearRiesgo","retornoSeleccionRiesgoSameComponent","retornoSeleccionRiesgoDiffComponent","editarRiesgo","retornoEditarRiesgo","terminoCrearRiesgoPasarAEdit","transaction","sql","Transaction","pool","begin","err","rolledBack","on","aborted","request","Request","query","result","console","log","rollback","commit","setState","recordset","pesoInstitucional","pesoExistente","i","length","peso","showRiesgos","self","setTimeout","id","nombreRiesgo","pesoRiesgo","toleranciaRiesgo","valorIdealRiesgo","padreRiesgo","undefined","ID","nombre","tolerancia","valorIdeal","idRiesgoPadre","localeCompare","configuracionHome","showFormula","showCondicionVar","updateNavBar","showUmbralHome","updateFormula","React","Component"],"mappings":";;;;;;;AAAA;;AACA;;AAEA;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;AAEA,IAAIA,SAAS,GAAG,KAAhB;;IAEqBC,U;;;;;AAEjB,sBAAYC,KAAZ,EAAmB;AAAA;;AAAA;;AACf,oFAAMA,KAAN;AACA,UAAKC,KAAL,GAAa;AACTC,MAAAA,OAAO,EAAE,EADA;AAETC,MAAAA,cAAc,EAAE,CAFP;AAGTC,MAAAA,oBAAoB,EAAE,CAAC,CAHd;AAITC,MAAAA,gBAAgB,EAAE;AAJT,KAAb;AAMA,UAAKC,UAAL,GAAkB,MAAKA,UAAL,CAAgBC,IAAhB,+BAAlB;AACA,UAAKC,8BAAL,GAAsC,MAAKA,8BAAL,CAAoCD,IAApC,+BAAtC;AACA,UAAKE,WAAL,GAAmB,MAAKA,WAAL,CAAiBF,IAAjB,+BAAnB;AACA,UAAKG,mCAAL,GAA2C,MAAKA,mCAAL,CAAyCH,IAAzC,+BAA3C;AACA,UAAKI,mCAAL,GAA2C,MAAKA,mCAAL,CAAyCJ,IAAzC,+BAA3C;AACA,UAAKK,YAAL,GAAoB,MAAKA,YAAL,CAAkBL,IAAlB,+BAApB;AACA,UAAKM,mBAAL,GAA2B,MAAKA,mBAAL,CAAyBN,IAAzB,+BAA3B;AACA,UAAKO,4BAAL,GAAoC,MAAKA,4BAAL,CAAkCP,IAAlC,+BAApC;AAfe;AAgBlB;;;;wCAEmB;AAChBT,MAAAA,SAAS,GAAG,IAAZ;AACA,WAAKQ,UAAL;AACH;;;iCAEa;AAAA;;AACV,UAAMS,WAAW,GAAG,IAAIC,kBAAIC,WAAR,CAAqB,KAAKjB,KAAL,CAAWkB,IAAhC,CAApB;AACAH,MAAAA,WAAW,CAACI,KAAZ,CAAkB,UAAAC,GAAG,EAAI;AACrB,YAAIC,UAAU,GAAG,KAAjB;AACAN,QAAAA,WAAW,CAACO,EAAZ,CAAe,UAAf,EAA2B,UAAAC,OAAO,EAAI;AAClCF,UAAAA,UAAU,GAAG,IAAb;AACH,SAFD;AAGA,YAAMG,OAAO,GAAG,IAAIR,kBAAIS,OAAR,CAAgBV,WAAhB,CAAhB;AACAS,QAAAA,OAAO,CAACE,KAAR,CAAc,uBAAd,EAAuC,UAACN,GAAD,EAAMO,MAAN,EAAiB;AACpD,cAAIP,GAAJ,EAAS;AACL,gBAAI,CAACC,UAAL,EAAiB;AACbO,cAAAA,OAAO,CAACC,GAAR,CAAYT,GAAZ;AACAL,cAAAA,WAAW,CAACe,QAAZ,CAAqB,UAAAV,GAAG,EAAI,CAC3B,CADD;AAEH;AACJ,WAND,MAMO;AACHL,YAAAA,WAAW,CAACgB,MAAZ,CAAmB,UAAAX,GAAG,EAAI;AACtB,cAAA,MAAI,CAACY,QAAL,CAAc;AACV9B,gBAAAA,OAAO,EAAEyB,MAAM,CAACM;AADN,eAAd,EAEG,MAAI,CAACzB,8BAFR;AAGH,aAJD;AAKH;AACJ,SAdD;AAeH,OArBD,EAFU,CAuBN;AACP;;;qDAEiC;AAC9B,UAAI0B,iBAAiB,GAAG,GAAxB;AACA,UAAIC,aAAa,GAAG,CAApB;;AACA,WAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKnC,KAAL,CAAWC,OAAX,CAAmBmC,MAAvC,EAA+CD,CAAC,EAAhD,EAAoD;AAChDD,QAAAA,aAAa,IAAI,KAAKlC,KAAL,CAAWC,OAAX,CAAmBkC,CAAnB,EAAsBE,IAAvC;AACH;;AAAA;AACDV,MAAAA,OAAO,CAACC,GAAR,CAAY,mBAAZ;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYK,iBAAZ;AACAN,MAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYM,aAAZ;AACA,WAAKH,QAAL,CAAc;AACV7B,QAAAA,cAAc,EAAE+B,iBAAiB,GAACC;AADxB,OAAd;AAGH;;;2CAEsB;AACnBrC,MAAAA,SAAS,GAAG,KAAZ;AACH;;;kCAEc;AACX,WAAKkC,QAAL,CAAc;AACV3B,QAAAA,gBAAgB,EAAE;AADR,OAAd;AAGH;;;0DAEsC;AACnC,WAAK2B,QAAL,CAAc;AACV5B,QAAAA,oBAAoB,EAAE,CAAC,CADb;AAEVC,QAAAA,gBAAgB,EAAE;AAFR,OAAd;AAIH;;;0DAEsC;AACnC,WAAKL,KAAL,CAAWuC,WAAX;AACA,UAAIC,IAAI,GAAG,IAAX;AACAC,MAAAA,UAAU,CAAC,YAAU;AACjBD,QAAAA,IAAI,CAACR,QAAL,CAAc;AACV5B,UAAAA,oBAAoB,EAAE,CAAC,CADb;AAEVC,UAAAA,gBAAgB,EAAE;AAFR,SAAd;AAIH,OALS,EAKP,GALO,CAAV;AAMH;;;iCAEaqC,E,EAAIC,Y,EAAcC,U,EAAYC,gB,EAAkBC,gB,EAAkBC,W,EAAa;AACzF,WAAKf,QAAL,CAAc;AACV5B,QAAAA,oBAAoB,EAAEsC,EADZ;AAEVrC,QAAAA,gBAAgB,EAAE,cAFR;AAGVsC,QAAAA,YAAY,EAAEA,YAHJ;AAIVC,QAAAA,UAAU,EAAEA,UAJF;AAKVC,QAAAA,gBAAgB,EAAEA,gBALR;AAMVC,QAAAA,gBAAgB,EAAEA,gBANR;AAOVC,QAAAA,WAAW,EAAEA;AAPH,OAAd;AASH;;;0CAEsB;AACnB,WAAK/C,KAAL,CAAWuC,WAAX;AACA,UAAIC,IAAI,GAAG,IAAX;;AACA,UAAG1C,SAAH,EAAc;AACV8B,QAAAA,OAAO,CAACC,GAAR,CAAY,IAAZ;AACH,OAFD,MAEO;AACHD,QAAAA,OAAO,CAACC,GAAR,CAAY,IAAZ;AACH;;AACDY,MAAAA,UAAU,CAAC,YAAU;AACjB,YAAG3C,SAAH,EAAc;AACV8B,UAAAA,OAAO,CAACC,GAAR,CAAY,IAAZ;AACH,SAFD,MAEO;AACHD,UAAAA,OAAO,CAACC,GAAR,CAAY,IAAZ;AACH;;AACDD,QAAAA,OAAO,CAACC,GAAR,CAAYW,IAAZ;AACAA,QAAAA,IAAI,CAACR,QAAL,CAAc;AACV3B,UAAAA,gBAAgB,EAAE;AADR,SAAd;AAGH,OAVS,EAUP,IAVO,CAAV;AAWH;;;mDAE+B;AAAA;;AAC5B,UAAMU,WAAW,GAAG,IAAIC,kBAAIC,WAAR,CAAqB,KAAKjB,KAAL,CAAWkB,IAAhC,CAApB;AACAH,MAAAA,WAAW,CAACI,KAAZ,CAAkB,UAAAC,GAAG,EAAI;AACrB,YAAIC,UAAU,GAAG,KAAjB;AACAN,QAAAA,WAAW,CAACO,EAAZ,CAAe,UAAf,EAA2B,UAAAC,OAAO,EAAI;AAClCF,UAAAA,UAAU,GAAG,IAAb;AACH,SAFD;AAGA,YAAMG,OAAO,GAAG,IAAIR,kBAAIS,OAAR,CAAgBV,WAAhB,CAAhB;AACAS,QAAAA,OAAO,CAACE,KAAR,CAAc,8CAAd,EAA8D,UAACN,GAAD,EAAMO,MAAN,EAAiB;AAC3E,cAAIP,GAAJ,EAAS;AACL,gBAAI,CAACC,UAAL,EAAiB;AACbO,cAAAA,OAAO,CAACC,GAAR,CAAYT,GAAZ;AACAL,cAAAA,WAAW,CAACe,QAAZ,CAAqB,UAAAV,GAAG,EAAI,CAC3B,CADD;AAEH;AACJ,WAND,MAMO;AACHL,YAAAA,WAAW,CAACgB,MAAZ,CAAmB,UAAAX,GAAG,EAAI;AACtB,kBAAGO,MAAM,CAACM,SAAP,IAAoBe,SAAvB,EAAkC;AAC9B,oBAAGrB,MAAM,CAACM,SAAP,CAAiBI,MAApB,EAA4B;AACxB,kBAAA,MAAI,CAACzB,YAAL,CAAkBe,MAAM,CAACM,SAAP,CAAiB,CAAjB,EAAoBgB,EAAtC,EAA0CtB,MAAM,CAACM,SAAP,CAAiB,CAAjB,EAAoBiB,MAA9D,EAAsEvB,MAAM,CAACM,SAAP,CAAiB,CAAjB,EAAoBK,IAA1F,EAAgGX,MAAM,CAACM,SAAP,CAAiB,CAAjB,EAAoBkB,UAApH,EAAgIxB,MAAM,CAACM,SAAP,CAAiB,CAAjB,EAAoBmB,UAApJ,EAAgKzB,MAAM,CAACM,SAAP,CAAiB,CAAjB,EAAoBoB,aAApL;AACH;AACJ;AACJ,aAND;AAOH;AACJ,SAhBD;AAiBH,OAvBD,EAF4B,CAyBxB;AACP;;;6BAEQ;AACL,UAAG,KAAKpD,KAAL,CAAWI,gBAAX,CAA4BiD,aAA5B,CAA0C,WAA1C,KAA0D,CAA7D,EAAgE;AAC5D,eACI,6CACI,gCAAC,6BAAD;AAAmB,UAAA,IAAI,EAAE,KAAKtD,KAAL,CAAWkB,IAApC;AAA0C,UAAA,iBAAiB,EAAE,KAAKlB,KAAL,CAAWuD,iBAAxE;AAA2F,UAAA,WAAW,EAAE,KAAK9C,WAA7G;AAA0H,UAAA,YAAY,EAAE,KAAKG,YAA7I;AAA2J,UAAA,OAAO,EAAE,KAAKX,KAAL,CAAWC;AAA/K,eADJ,CADJ;AAKH,OAND,MAMO,IAAG,KAAKD,KAAL,CAAWI,gBAAX,CAA4BiD,aAA5B,CAA0C,aAA1C,KAA4D,CAA/D,EAAkE;AACrE,eACI,6CACI,gCAAC,uBAAD;AAAa,UAAA,IAAI,EAAE,KAAKtD,KAAL,CAAWkB,IAA9B;AAAoC,UAAA,WAAW,EAAE,KAAKlB,KAAL,CAAWwD,WAA5D;AAAyE,UAAA,gBAAgB,EAAE,KAAKxD,KAAL,CAAWyD,gBAAtG;AAAwH,UAAA,WAAW,EAAE,KAAKzD,KAAL,CAAWuC,WAAhJ;AAA6J,UAAA,sBAAsB,EAAE,KAAK7B,mCAA1L;AAA+N,UAAA,4BAA4B,EAAE,KAAKC,mCAAlQ;AAAuS,UAAA,iBAAiB,EAAE,KAAKX,KAAL,CAAWuD,iBAArU;AAAwV,UAAA,YAAY,EAAE,KAAKvD,KAAL,CAAW0D,YAAjX;AAA+X,UAAA,cAAc,EAAE,KAAK1D,KAAL,CAAW2D,cAA1Z;AAA0a,UAAA,OAAO,EAAE,KAAK1D,KAAL,CAAWC,OAA9b;AAAuc,UAAA,kBAAkB,EAAE,KAAKY,4BAAhe;AAA8f,UAAA,iBAAiB,EAAE,KAAKR,UAAthB;AAAkiB,UAAA,UAAU,EAAE,KAAKL,KAAL,CAAWE;AAAzjB,eADJ,CADJ;AAKH,OANM,MAMA,IAAG,KAAKF,KAAL,CAAWI,gBAAX,CAA4BiD,aAA5B,CAA0C,cAA1C,KAA6D,CAAhE,EAAmE;AACtE,eACI,6CACI,gCAAC,wBAAD;AAAc,UAAA,IAAI,EAAE,KAAKtD,KAAL,CAAWkB,IAA/B;AAAqC,UAAA,WAAW,EAAE,KAAKlB,KAAL,CAAWwD,WAA7D;AAA0E,UAAA,gBAAgB,EAAE,KAAKxD,KAAL,CAAWyD,gBAAvG;AAAyH,UAAA,WAAW,EAAE,KAAKzD,KAAL,CAAWuC,WAAjJ;AAA8J,UAAA,sBAAsB,EAAE,KAAK7B,mCAA3L;AAAgO,UAAA,4BAA4B,EAAE,KAAKC,mCAAnQ;AAAwS,UAAA,iBAAiB,EAAE,KAAKX,KAAL,CAAWuD,iBAAtU;AAAyV,UAAA,YAAY,EAAE,KAAKvD,KAAL,CAAW0D,YAAlX;AAAgY,UAAA,cAAc,EAAE,KAAK1D,KAAL,CAAW2D,cAA3Z;AAA2a,UAAA,OAAO,EAAE,KAAK1D,KAAL,CAAWC,OAA/b;AAAwc,UAAA,YAAY,EAAE,KAAKD,KAAL,CAAW0C,YAAje;AAA+e,UAAA,UAAU,EAAE,KAAK1C,KAAL,CAAW2C,UAAtgB;AAAkhB,UAAA,gBAAgB,EAAE,KAAK3C,KAAL,CAAW4C,gBAA/iB;AAAikB,UAAA,gBAAgB,EAAE,KAAK5C,KAAL,CAAW6C,gBAA9lB;AAAgnB,UAAA,WAAW,EAAE,KAAK7C,KAAL,CAAW8C,WAAxoB;AAAqpB,UAAA,aAAa,EAAE,KAAK/C,KAAL,CAAW4D,aAA/qB;AAA8rB,UAAA,oBAAoB,EAAE,KAAK3D,KAAL,CAAWG;AAA/tB,eADJ,CADJ;AAKH;AACJ;;;;EA/KmCyD,kBAAMC,S","sourcesContent":["import React from 'react';\nimport sql from 'mssql';\n\nimport SeleccionarRiesgo from './SeleccionarRiesgo.js';\nimport CrearRiesgo from './CrearRiesgo.js';\nimport EditarRiesgo from './EditarRiesgo.js';\n\nvar isMounted = false;\n\nexport default class RiesgoHome extends React.Component {\n\n    constructor(props) {\n        super(props);\n        this.state = {\n            riesgos: [],\n            pesoDisponible: 0,\n            idRiesgoSeleccionado: -1,\n            componenteActual: \"selRiesgo\"\n        }\n        this.getRiesgos = this.getRiesgos.bind(this);\n        this.acutalizarPesoMaximoDisponible = this.acutalizarPesoMaximoDisponible.bind(this);\n        this.crearRiesgo = this.crearRiesgo.bind(this);\n        this.retornoSeleccionRiesgoSameComponent = this.retornoSeleccionRiesgoSameComponent.bind(this);\n        this.retornoSeleccionRiesgoDiffComponent = this.retornoSeleccionRiesgoDiffComponent.bind(this);\n        this.editarRiesgo = this.editarRiesgo.bind(this);\n        this.retornoEditarRiesgo = this.retornoEditarRiesgo.bind(this);\n        this.terminoCrearRiesgoPasarAEdit = this.terminoCrearRiesgoPasarAEdit.bind(this);\n    }\n\n    componentDidMount() {\n        isMounted = true;\n        this.getRiesgos();\n    }\n\n    getRiesgos () {\n        const transaction = new sql.Transaction( this.props.pool );\n        transaction.begin(err => {\n            var rolledBack = false;\n            transaction.on('rollback', aborted => {\n                rolledBack = true;\n            });\n            const request = new sql.Request(transaction);\n            request.query(\"select * from Riesgos\", (err, result) => {\n                if (err) {\n                    if (!rolledBack) {\n                        console.log(err);\n                        transaction.rollback(err => {\n                        });\n                    }\n                } else {\n                    transaction.commit(err => {\n                        this.setState({\n                            riesgos: result.recordset\n                        }, this.acutalizarPesoMaximoDisponible );\n                    });\n                }\n            });\n        }); // fin transaction\n    }\n\n    acutalizarPesoMaximoDisponible () {\n        var pesoInstitucional = 100;\n        var pesoExistente = 0;\n        for (var i = 0; i < this.state.riesgos.length; i++) {\n            pesoExistente += this.state.riesgos[i].peso;\n        };\n        console.log('pesoInstitucional');\n        console.log(pesoInstitucional);\n        console.log('pesoExistente');\n        console.log(pesoExistente);\n        this.setState({\n            pesoDisponible: pesoInstitucional-pesoExistente\n        });\n    }\n\n    componentWillUnmount() {\n        isMounted = false;\n    }\n\n    crearRiesgo () {\n        this.setState({\n            componenteActual: \"crearRiesgo\"\n        });\n    }\n\n    retornoSeleccionRiesgoSameComponent () {\n        this.setState({\n            idRiesgoSeleccionado: -1,\n            componenteActual: \"selRiesgo\"\n        });\n    }\n\n    retornoSeleccionRiesgoDiffComponent () {\n        this.props.showRiesgos();\n        var self = this;\n        setTimeout(function(){\n            self.setState({\n                idRiesgoSeleccionado: -1,\n                componenteActual: \"selRiesgo\"\n            });\n        }, 500);\n    }\n\n    editarRiesgo (id, nombreRiesgo, pesoRiesgo, toleranciaRiesgo, valorIdealRiesgo, padreRiesgo) {\n        this.setState({\n            idRiesgoSeleccionado: id,\n            componenteActual: \"editarRiesgo\",\n            nombreRiesgo: nombreRiesgo,\n            pesoRiesgo: pesoRiesgo,\n            toleranciaRiesgo: toleranciaRiesgo,\n            valorIdealRiesgo: valorIdealRiesgo,\n            padreRiesgo: padreRiesgo\n        });\n    }\n\n    retornoEditarRiesgo () {\n        this.props.showRiesgos();\n        var self = this;\n        if(isMounted) {\n            console.log(\"SI\")\n        } else {\n            console.log(\"NO\")\n        }\n        setTimeout(function(){\n            if(isMounted) {\n                console.log(\"SI\")\n            } else {\n                console.log(\"NO\")\n            }\n            console.log(self)\n            self.setState({\n                componenteActual: \"editarRiesgo\"\n            });\n        }, 3500);\n    }\n\n    terminoCrearRiesgoPasarAEdit () {\n        const transaction = new sql.Transaction( this.props.pool );\n        transaction.begin(err => {\n            var rolledBack = false;\n            transaction.on('rollback', aborted => {\n                rolledBack = true;\n            });\n            const request = new sql.Request(transaction);\n            request.query(\"select top 1 * from Riesgos order by ID desc\", (err, result) => {\n                if (err) {\n                    if (!rolledBack) {\n                        console.log(err);\n                        transaction.rollback(err => {\n                        });\n                    }\n                } else {\n                    transaction.commit(err => {\n                        if(result.recordset != undefined) {\n                            if(result.recordset.length) {\n                                this.editarRiesgo(result.recordset[0].ID, result.recordset[0].nombre, result.recordset[0].peso, result.recordset[0].tolerancia, result.recordset[0].valorIdeal, result.recordset[0].idRiesgoPadre);\n                            }\n                        }\n                    });\n                }\n            });\n        }); // fin transaction\n    }\n\n    render() {\n        if(this.state.componenteActual.localeCompare(\"selRiesgo\") == 0) {\n            return (\n                <div>\n                    <SeleccionarRiesgo pool={this.props.pool} configuracionHome={this.props.configuracionHome} crearRiesgo={this.crearRiesgo} editarRiesgo={this.editarRiesgo} riesgos={this.state.riesgos}> </SeleccionarRiesgo>\n                </div>\n            );\n        } else if(this.state.componenteActual.localeCompare(\"crearRiesgo\") == 0) {\n            return (\n                <div>\n                    <CrearRiesgo pool={this.props.pool} showFormula={this.props.showFormula} showCondicionVar={this.props.showCondicionVar} showRiesgos={this.props.showRiesgos} retornoSeleccionRiesgo={this.retornoSeleccionRiesgoSameComponent} retornoSeleccionRiesgoUmbral={this.retornoSeleccionRiesgoDiffComponent} configuracionHome={this.props.configuracionHome} updateNavBar={this.props.updateNavBar} showUmbralHome={this.props.showUmbralHome} riesgos={this.state.riesgos} terminoCrearRiesgo={this.terminoCrearRiesgoPasarAEdit} actualizarRiesgos={this.getRiesgos} pesoMaximo={this.state.pesoDisponible}> </CrearRiesgo>\n                </div>\n            );\n        } else if(this.state.componenteActual.localeCompare(\"editarRiesgo\") == 0) {\n            return (\n                <div>\n                    <EditarRiesgo pool={this.props.pool} showFormula={this.props.showFormula} showCondicionVar={this.props.showCondicionVar} showRiesgos={this.props.showRiesgos} retornoSeleccionRiesgo={this.retornoSeleccionRiesgoSameComponent} retornoSeleccionRiesgoUmbral={this.retornoSeleccionRiesgoDiffComponent} configuracionHome={this.props.configuracionHome} updateNavBar={this.props.updateNavBar} showUmbralHome={this.props.showUmbralHome} riesgos={this.state.riesgos} nombreRiesgo={this.state.nombreRiesgo} pesoRiesgo={this.state.pesoRiesgo} toleranciaRiesgo={this.state.toleranciaRiesgo} valorIdealRiesgo={this.state.valorIdealRiesgo} padreRiesgo={this.state.padreRiesgo} updateFormula={this.props.updateFormula} idRiesgoSeleccionado={this.state.idRiesgoSeleccionado}> </EditarRiesgo>\n                </div>\n            );\n        }\n    }\n}\n"],"file":"RiesgoHome.js"}