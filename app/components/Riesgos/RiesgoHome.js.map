{"version":3,"sources":["components/Riesgos/RiesgoHome.js"],"names":["RiesgoHome","props","componente","crearRiesgo","state","riesgos","pesoDisponible","idRiesgoSeleccionado","componenteActual","nombreRiesgo","pesoRiesgo","formulaRiesgo","responsableRiesgo","getRiesgos","bind","acutalizarPesoMaximoDisponible","retornoSeleccionRiesgo","editarRiesgo","terminoCrearRiesgoPasarAEdit","deleteRiesgo","updateBanderaCrearRiesgoFalse","transaction","sql","Transaction","pool","begin","err","rolledBack","on","aborted","request","Request","query","result","console","log","rollback","commit","setState","recordset","pesoInstitucional","pesoExistente","i","length","peso","id","ID","undefined","nombre","formula","responsable","index","alert","localeCompare","configuracionHome","showCondicionVar","showRiesgos","showUmbralHome","React","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport sql from 'mssql';\n\nimport SeleccionarRiesgo from './SeleccionarRiesgo.js';\nimport CrearRiesgo from './CrearRiesgo.js';\nimport EditarRiesgo from './EditarRiesgo.js';\n\nexport default class RiesgoHome extends React.Component {\n\n    constructor(props) {\n        super(props);\n        //cuando es llamado desde indicadores\n        var componente = \"selRiesgo\";\n        if(this.props.crearRiesgo)\n            componente = \"crearRiesgo\";\n        this.state = {\n            riesgos: [],\n            pesoDisponible: 0,\n            idRiesgoSeleccionado: -1,\n            componenteActual: componente,\n            nombreRiesgo: \"\",\n            pesoRiesgo: 0,\n            formulaRiesgo: \"\",\n            responsableRiesgo: \"\"\n        }\n        this.getRiesgos = this.getRiesgos.bind(this);\n        this.acutalizarPesoMaximoDisponible = this.acutalizarPesoMaximoDisponible.bind(this);\n        this.crearRiesgo = this.crearRiesgo.bind(this);\n        this.retornoSeleccionRiesgo = this.retornoSeleccionRiesgo.bind(this);\n        this.editarRiesgo = this.editarRiesgo.bind(this);\n        this.terminoCrearRiesgoPasarAEdit = this.terminoCrearRiesgoPasarAEdit.bind(this);\n        this.deleteRiesgo = this.deleteRiesgo.bind(this);\n    }\n\n    componentDidMount() {\n        this.getRiesgos();\n        this.props.updateBanderaCrearRiesgoFalse();\n    }\n\n    getRiesgos () {\n        const transaction = new sql.Transaction( this.props.pool );\n        transaction.begin(err => {\n            var rolledBack = false;\n            transaction.on('rollback', aborted => {\n                rolledBack = true;\n            });\n            const request = new sql.Request(transaction);\n            request.query(\"select * from Riesgos\", (err, result) => {\n                if (err) {\n                    if (!rolledBack) {\n                        console.log(err);\n                        transaction.rollback(err => {\n                        });\n                    }\n                } else {\n                    transaction.commit(err => {\n                        this.setState({\n                            riesgos: result.recordset\n                        }, this.acutalizarPesoMaximoDisponible );\n                    });\n                }\n            });\n        }); // fin transaction\n    }\n\n    acutalizarPesoMaximoDisponible () {\n        //validando para que despues de traer riesgos al crear uno nuevo no vuelva a sobrescribir pesoDisponible\n        if(this.state.idRiesgoSeleccionado == -1) {\n            var pesoInstitucional = 100;\n            var pesoExistente = 0;\n            for (var i = 0; i < this.state.riesgos.length; i++) {\n                pesoExistente += this.state.riesgos[i].peso;\n            };\n            this.setState({\n                pesoDisponible: pesoInstitucional-pesoExistente\n            });\n        }\n    }\n\n    crearRiesgo () {\n        this.setState({\n            componenteActual: \"crearRiesgo\"\n        });\n    }\n\n    retornoSeleccionRiesgo () {\n        this.setState({\n            idRiesgoSeleccionado: -1,\n            componenteActual: \"selRiesgo\"\n        }, this.acutalizarPesoMaximoDisponible );\n    }\n\n    editarRiesgo (id, nombreRiesgo, pesoRiesgo, formulaRiesgo, responsableRiesgo) {\n        if(this.state.pesoDisponible == 0) {\n            this.setState({\n                pesoDisponible: pesoRiesgo\n            });\n        } else {\n            var pesoInstitucional = 100;\n            var pesoExistente = 0;\n            for (var i = 0; i < this.state.riesgos.length; i++) {\n                if(this.state.riesgos[i].ID != id)\n                    pesoExistente += this.state.riesgos[i].peso;\n            };\n            this.setState({\n                pesoDisponible: pesoInstitucional-pesoExistente\n            });\n        }\n        this.setState({\n            idRiesgoSeleccionado: id,\n            componenteActual: \"editarRiesgo\",\n            nombreRiesgo: nombreRiesgo,\n            pesoRiesgo: pesoRiesgo,\n            formulaRiesgo: formulaRiesgo,\n            responsableRiesgo: responsableRiesgo\n        });\n    }\n\n    terminoCrearRiesgoPasarAEdit () {\n        const transaction = new sql.Transaction( this.props.pool );\n        transaction.begin(err => {\n            var rolledBack = false;\n            transaction.on('rollback', aborted => {\n                rolledBack = true;\n            });\n            const request = new sql.Request(transaction);\n            request.query(\"select top 1 * from Riesgos order by ID desc\", (err, result) => {\n                if (err) {\n                    if (!rolledBack) {\n                        console.log(err);\n                        transaction.rollback(err => {\n                        });\n                    }\n                } else {\n                    transaction.commit(err => {\n                        if(result.recordset != undefined) {\n                            if(result.recordset.length) {\n                                this.editarRiesgo(result.recordset[0].ID, result.recordset[0].nombre, result.recordset[0].peso, result.recordset[0].formula, result.recordset[0].responsable);\n                            }\n                        }\n                    });\n                }\n            });\n        }); // fin transaction\n    }\n\n    deleteRiesgo (index) {\n        const transaction = new sql.Transaction( this.props.pool );\n        transaction.begin(err => {\n            var rolledBack = false;\n            transaction.on('rollback', aborted => {\n                rolledBack = true;\n            });\n            const request = new sql.Request(transaction);\n            request.query(\"delete from Riesgos where ID = \"+index, (err, result) => {\n                if (err) {\n                    if (!rolledBack) {\n                        console.log(err);\n                        transaction.rollback(err => {\n                        });\n                    }\n                } else {\n                    transaction.commit(err => {\n                        alert(\"Riesgo Eliminado\");\n                        this.getRiesgos();\n                    });\n                }\n            });\n        }); // fin transaction\n    }\n\n    render() {\n        if(this.state.componenteActual.localeCompare(\"selRiesgo\") == 0) {\n            return (\n                <div>\n                    <SeleccionarRiesgo pool={this.props.pool}\n                                        deleteRiesgo={this.deleteRiesgo}\n                                        configuracionHome={this.props.configuracionHome}\n                                        crearRiesgo={this.crearRiesgo}\n                                        editarRiesgo={this.editarRiesgo}\n                                        riesgos={this.state.riesgos}> </SeleccionarRiesgo>\n                </div>\n            );\n        } else if(this.state.componenteActual.localeCompare(\"crearRiesgo\") == 0) {\n            return (\n                <div>\n                    <CrearRiesgo pool={this.props.pool}\n                                    showCondicionVar={this.props.showCondicionVar}\n                                    showRiesgos={this.props.showRiesgos}\n                                    retornoSeleccionRiesgo={this.retornoSeleccionRiesgo}\n                                    configuracionHome={this.props.configuracionHome}\n                                    showUmbralHome={this.props.showUmbralHome}\n                                    riesgos={this.state.riesgos}\n                                    terminoCrearRiesgo={this.terminoCrearRiesgoPasarAEdit}\n                                    actualizarRiesgos={this.getRiesgos}\n                                    pesoMaximo={this.state.pesoDisponible}> </CrearRiesgo>\n                </div>\n            );\n        } else if(this.state.componenteActual.localeCompare(\"editarRiesgo\") == 0) {\n            return (\n                <div>\n                    <EditarRiesgo pool={this.props.pool}\n                                    showCondicionVar={this.props.showCondicionVar}\n                                    showRiesgos={this.props.showRiesgos}\n                                    retornoSeleccionRiesgo={this.retornoSeleccionRiesgo}\n                                    configuracionHome={this.props.configuracionHome}\n                                    showUmbralHome={this.props.showUmbralHome}\n                                    riesgos={this.state.riesgos}\n                                    nombreRiesgo={this.state.nombreRiesgo}\n                                    pesoRiesgo={this.state.pesoRiesgo}\n                                    formulaRiesgo={this.state.formulaRiesgo}\n                                    getRiesgos={this.getRiesgos}\n                                    idRiesgoSeleccionado={this.state.idRiesgoSeleccionado}\n                                    pesoMaximo={this.state.pesoDisponible}\n                                    responsableRiesgo={this.state.responsableRiesgo}\n                                    editarRiesgo={this.editarRiesgo}> </EditarRiesgo>\n                </div>\n            );\n        }\n    }\n}\n"],"file":"RiesgoHome.js"}