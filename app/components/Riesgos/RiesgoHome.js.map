{"version":3,"sources":["components/Riesgos/RiesgoHome.js"],"names":["RiesgoHome","props","componente","crearRiesgo","state","riesgos","pesoDisponible","idRiesgoSeleccionado","componenteActual","getRiesgos","bind","acutalizarPesoMaximoDisponible","retornoSeleccionRiesgo","editarRiesgo","terminoCrearRiesgoPasarAEdit","deleteRiesgo","updateBanderaCrearRiesgoFalse","transaction","sql","Transaction","pool","begin","err","rolledBack","on","aborted","request","Request","query","result","console","log","rollback","commit","setState","recordset","pesoInstitucional","pesoExistente","i","length","peso","id","nombreRiesgo","pesoRiesgo","toleranciaRiesgo","valorIdealRiesgo","padreRiesgo","undefined","ID","nombre","tolerancia","valorIdeal","idRiesgoPadre","index","alert","localeCompare","configuracionHome","showCondicionVar","showRiesgos","updateNavBar","showUmbralHome","updateFormula","React","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport sql from 'mssql';\n\nimport SeleccionarRiesgo from './SeleccionarRiesgo.js';\nimport CrearRiesgo from './CrearRiesgo.js';\nimport EditarRiesgo from './EditarRiesgo.js';\n\nexport default class RiesgoHome extends React.Component {\n\n    constructor(props) {\n        super(props);\n        var componente = \"selRiesgo\";\n        if(this.props.crearRiesgo)\n            componente = \"crearRiesgo\";\n        this.state = {\n            riesgos: [],\n            pesoDisponible: 0,\n            idRiesgoSeleccionado: -1,\n            componenteActual: componente\n        }\n        this.getRiesgos = this.getRiesgos.bind(this);\n        this.acutalizarPesoMaximoDisponible = this.acutalizarPesoMaximoDisponible.bind(this);\n        this.crearRiesgo = this.crearRiesgo.bind(this);\n        this.retornoSeleccionRiesgo = this.retornoSeleccionRiesgo.bind(this);\n        this.editarRiesgo = this.editarRiesgo.bind(this);\n        this.terminoCrearRiesgoPasarAEdit = this.terminoCrearRiesgoPasarAEdit.bind(this);\n        this.deleteRiesgo = this.deleteRiesgo.bind(this);\n    }\n\n    componentDidMount() {\n        this.getRiesgos();\n        this.props.updateBanderaCrearRiesgoFalse();\n    }\n\n    getRiesgos () {\n        const transaction = new sql.Transaction( this.props.pool );\n        transaction.begin(err => {\n            var rolledBack = false;\n            transaction.on('rollback', aborted => {\n                rolledBack = true;\n            });\n            const request = new sql.Request(transaction);\n            request.query(\"select * from Riesgos\", (err, result) => {\n                if (err) {\n                    if (!rolledBack) {\n                        console.log(err);\n                        transaction.rollback(err => {\n                        });\n                    }\n                } else {\n                    transaction.commit(err => {\n                        this.setState({\n                            riesgos: result.recordset\n                        }, this.acutalizarPesoMaximoDisponible );\n                    });\n                }\n            });\n        }); // fin transaction\n    }\n\n    acutalizarPesoMaximoDisponible () {\n        var pesoInstitucional = 100;\n        var pesoExistente = 0;\n        for (var i = 0; i < this.state.riesgos.length; i++) {\n            pesoExistente += this.state.riesgos[i].peso;\n        };\n        console.log('pesoInstitucional');\n        console.log(pesoInstitucional);\n        console.log('pesoExistente');\n        console.log(pesoExistente);\n        this.setState({\n            pesoDisponible: pesoInstitucional-pesoExistente\n        });\n    }\n\n    crearRiesgo () {\n        this.setState({\n            componenteActual: \"crearRiesgo\"\n        });\n    }\n\n    retornoSeleccionRiesgo () {\n        this.setState({\n            idRiesgoSeleccionado: -1,\n            componenteActual: \"selRiesgo\"\n        });\n    }\n\n    editarRiesgo (id, nombreRiesgo, pesoRiesgo, toleranciaRiesgo, valorIdealRiesgo, padreRiesgo) {\n        this.setState({\n            idRiesgoSeleccionado: id,\n            componenteActual: \"editarRiesgo\",\n            nombreRiesgo: nombreRiesgo,\n            pesoRiesgo: pesoRiesgo,\n            toleranciaRiesgo: toleranciaRiesgo,\n            valorIdealRiesgo: valorIdealRiesgo,\n            padreRiesgo: padreRiesgo\n        }, console.log(this.state.idRiesgoSeleccionado) );\n    }\n\n    terminoCrearRiesgoPasarAEdit () {\n        const transaction = new sql.Transaction( this.props.pool );\n        transaction.begin(err => {\n            var rolledBack = false;\n            transaction.on('rollback', aborted => {\n                rolledBack = true;\n            });\n            const request = new sql.Request(transaction);\n            request.query(\"select top 1 * from Riesgos order by ID desc\", (err, result) => {\n                if (err) {\n                    if (!rolledBack) {\n                        console.log(err);\n                        transaction.rollback(err => {\n                        });\n                    }\n                } else {\n                    transaction.commit(err => {\n                        if(result.recordset != undefined) {\n                            if(result.recordset.length) {\n                                this.editarRiesgo(result.recordset[0].ID, result.recordset[0].nombre, result.recordset[0].peso, result.recordset[0].tolerancia, result.recordset[0].valorIdeal, result.recordset[0].idRiesgoPadre);\n                            }\n                        }\n                    });\n                }\n            });\n        }); // fin transaction\n    }\n\n    deleteRiesgo (index) {\n        const transaction = new sql.Transaction( this.props.pool );\n        transaction.begin(err => {\n            var rolledBack = false;\n            transaction.on('rollback', aborted => {\n                rolledBack = true;\n            });\n            const request = new sql.Request(transaction);\n            request.query(\"delete from Riesgos where ID = \"+index, (err, result) => {\n                if (err) {\n                    if (!rolledBack) {\n                        console.log(err);\n                        transaction.rollback(err => {\n                        });\n                    }\n                } else {\n                    transaction.commit(err => {\n                        alert(\"Riesgo Eliminado\");\n                        this.getRiesgos();\n                    });\n                }\n            });\n        }); // fin transaction\n    }\n\n    render() {\n        if(this.state.componenteActual.localeCompare(\"selRiesgo\") == 0) {\n            return (\n                <div>\n                    <SeleccionarRiesgo pool={this.props.pool} deleteRiesgo={this.deleteRiesgo} configuracionHome={this.props.configuracionHome} crearRiesgo={this.crearRiesgo} editarRiesgo={this.editarRiesgo} riesgos={this.state.riesgos}> </SeleccionarRiesgo>\n                </div>\n            );\n        } else if(this.state.componenteActual.localeCompare(\"crearRiesgo\") == 0) {\n            return (\n                <div>\n                    <CrearRiesgo pool={this.props.pool} showCondicionVar={this.props.showCondicionVar} showRiesgos={this.props.showRiesgos} retornoSeleccionRiesgo={this.retornoSeleccionRiesgo} configuracionHome={this.props.configuracionHome} updateNavBar={this.props.updateNavBar} showUmbralHome={this.props.showUmbralHome} riesgos={this.state.riesgos} terminoCrearRiesgo={this.terminoCrearRiesgoPasarAEdit} actualizarRiesgos={this.getRiesgos} pesoMaximo={this.state.pesoDisponible}> </CrearRiesgo>\n                </div>\n            );\n        } else if(this.state.componenteActual.localeCompare(\"editarRiesgo\") == 0) {\n            return (\n                <div>\n                    <EditarRiesgo pool={this.props.pool} showCondicionVar={this.props.showCondicionVar} showRiesgos={this.props.showRiesgos} retornoSeleccionRiesgo={this.retornoSeleccionRiesgo} configuracionHome={this.props.configuracionHome} updateNavBar={this.props.updateNavBar} showUmbralHome={this.props.showUmbralHome} riesgos={this.state.riesgos} nombreRiesgo={this.state.nombreRiesgo} pesoRiesgo={this.state.pesoRiesgo} toleranciaRiesgo={this.state.toleranciaRiesgo} valorIdealRiesgo={this.state.valorIdealRiesgo} padreRiesgo={this.state.padreRiesgo} updateFormula={this.props.updateFormula} idRiesgoSeleccionado={this.state.idRiesgoSeleccionado}> </EditarRiesgo>\n                </div>\n            );\n        }\n    }\n}\n"],"file":"RiesgoHome.js"}