{"version":3,"sources":["components/Riesgos/RiesgoHome.js"],"names":["RiesgoHome","props","componente","crearRiesgo","state","riesgos","pesoDisponible","idRiesgoSeleccionado","componenteActual","nombreRiesgo","pesoRiesgo","formulaRiesgo","getRiesgos","bind","acutalizarPesoMaximoDisponible","retornoSeleccionRiesgo","editarRiesgo","terminoCrearRiesgoPasarAEdit","deleteRiesgo","updateBanderaCrearRiesgoFalse","transaction","sql","Transaction","pool","begin","err","rolledBack","on","aborted","request","Request","query","result","console","log","rollback","commit","setState","recordset","pesoInstitucional","pesoExistente","i","length","peso","id","undefined","ID","nombre","tolerancia","valorIdeal","idRiesgoPadre","index","alert","localeCompare","configuracionHome","showCondicionVar","showRiesgos","showUmbralHome","React","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport sql from 'mssql';\n\nimport SeleccionarRiesgo from './SeleccionarRiesgo.js';\nimport CrearRiesgo from './CrearRiesgo.js';\nimport EditarRiesgo from './EditarRiesgo.js';\n\nexport default class RiesgoHome extends React.Component {\n\n    constructor(props) {\n        super(props);\n        //cuando es llamado desde indicadores\n        var componente = \"selRiesgo\";\n        if(this.props.crearRiesgo)\n            componente = \"crearRiesgo\";\n        this.state = {\n            riesgos: [],\n            pesoDisponible: 0,\n            idRiesgoSeleccionado: -1,\n            componenteActual: componente,\n            nombreRiesgo: \"\",\n            pesoRiesgo: 0,\n            formulaRiesgo: \"\"\n        }\n        this.getRiesgos = this.getRiesgos.bind(this);\n        this.acutalizarPesoMaximoDisponible = this.acutalizarPesoMaximoDisponible.bind(this);\n        this.crearRiesgo = this.crearRiesgo.bind(this);\n        this.retornoSeleccionRiesgo = this.retornoSeleccionRiesgo.bind(this);\n        this.editarRiesgo = this.editarRiesgo.bind(this);\n        this.terminoCrearRiesgoPasarAEdit = this.terminoCrearRiesgoPasarAEdit.bind(this);\n        this.deleteRiesgo = this.deleteRiesgo.bind(this);\n    }\n\n    componentDidMount() {\n        this.getRiesgos();\n        this.props.updateBanderaCrearRiesgoFalse();\n    }\n\n    getRiesgos () {\n        const transaction = new sql.Transaction( this.props.pool );\n        transaction.begin(err => {\n            var rolledBack = false;\n            transaction.on('rollback', aborted => {\n                rolledBack = true;\n            });\n            const request = new sql.Request(transaction);\n            request.query(\"select * from Riesgos\", (err, result) => {\n                if (err) {\n                    if (!rolledBack) {\n                        console.log(err);\n                        transaction.rollback(err => {\n                        });\n                    }\n                } else {\n                    transaction.commit(err => {\n                        this.setState({\n                            riesgos: result.recordset\n                        }, this.acutalizarPesoMaximoDisponible );\n                    });\n                }\n            });\n        }); // fin transaction\n    }\n\n    acutalizarPesoMaximoDisponible () {\n        var pesoInstitucional = 100;\n        var pesoExistente = 0;\n        for (var i = 0; i < this.state.riesgos.length; i++) {\n            pesoExistente += this.state.riesgos[i].peso;\n        };\n        this.setState({\n            pesoDisponible: pesoInstitucional-pesoExistente\n        });\n    }\n\n    crearRiesgo () {\n        this.setState({\n            componenteActual: \"crearRiesgo\"\n        });\n    }\n\n    retornoSeleccionRiesgo () {\n        this.setState({\n            idRiesgoSeleccionado: -1,\n            componenteActual: \"selRiesgo\"\n        });\n    }\n\n    editarRiesgo (id, nombreRiesgo, pesoRiesgo, formulaRiesgo) {\n        this.setState({\n            idRiesgoSeleccionado: id,\n            componenteActual: \"editarRiesgo\",\n            nombreRiesgo: nombreRiesgo,\n            pesoRiesgo: pesoRiesgo,\n            formulaRiesgo: formulaRiesgo,\n        });\n    }\n\n    terminoCrearRiesgoPasarAEdit () {\n        const transaction = new sql.Transaction( this.props.pool );\n        transaction.begin(err => {\n            var rolledBack = false;\n            transaction.on('rollback', aborted => {\n                rolledBack = true;\n            });\n            const request = new sql.Request(transaction);\n            request.query(\"select top 1 * from Riesgos order by ID desc\", (err, result) => {\n                if (err) {\n                    if (!rolledBack) {\n                        console.log(err);\n                        transaction.rollback(err => {\n                        });\n                    }\n                } else {\n                    transaction.commit(err => {\n                        if(result.recordset != undefined) {\n                            if(result.recordset.length) {\n                                this.editarRiesgo(result.recordset[0].ID, result.recordset[0].nombre, result.recordset[0].peso, result.recordset[0].tolerancia, result.recordset[0].valorIdeal, result.recordset[0].idRiesgoPadre);\n                            }\n                        }\n                    });\n                }\n            });\n        }); // fin transaction\n    }\n\n    deleteRiesgo (index) {\n        const transaction = new sql.Transaction( this.props.pool );\n        transaction.begin(err => {\n            var rolledBack = false;\n            transaction.on('rollback', aborted => {\n                rolledBack = true;\n            });\n            const request = new sql.Request(transaction);\n            request.query(\"delete from Riesgos where ID = \"+index, (err, result) => {\n                if (err) {\n                    if (!rolledBack) {\n                        console.log(err);\n                        transaction.rollback(err => {\n                        });\n                    }\n                } else {\n                    transaction.commit(err => {\n                        alert(\"Riesgo Eliminado\");\n                        this.getRiesgos();\n                    });\n                }\n            });\n        }); // fin transaction\n    }\n\n    render() {\n        if(this.state.componenteActual.localeCompare(\"selRiesgo\") == 0) {\n            return (\n                <div>\n                    <SeleccionarRiesgo pool={this.props.pool} deleteRiesgo={this.deleteRiesgo} configuracionHome={this.props.configuracionHome} crearRiesgo={this.crearRiesgo} editarRiesgo={this.editarRiesgo} riesgos={this.state.riesgos}> </SeleccionarRiesgo>\n                </div>\n            );\n        } else if(this.state.componenteActual.localeCompare(\"crearRiesgo\") == 0) {\n            return (\n                <div>\n                    <CrearRiesgo pool={this.props.pool}\n                                    showCondicionVar={this.props.showCondicionVar}\n                                    showRiesgos={this.props.showRiesgos}\n                                    retornoSeleccionRiesgo={this.retornoSeleccionRiesgo}\n                                    configuracionHome={this.props.configuracionHome}\n                                    showUmbralHome={this.props.showUmbralHome}\n                                    riesgos={this.state.riesgos}\n                                    terminoCrearRiesgo={this.terminoCrearRiesgoPasarAEdit}\n                                    actualizarRiesgos={this.getRiesgos}\n                                    pesoMaximo={this.state.pesoDisponible}> </CrearRiesgo>\n                </div>\n            );\n        } else if(this.state.componenteActual.localeCompare(\"editarRiesgo\") == 0) {\n            return (\n                <div>\n                    <EditarRiesgo pool={this.props.pool}\n                                    showCondicionVar={this.props.showCondicionVar}\n                                    showRiesgos={this.props.showRiesgos}\n                                    retornoSeleccionRiesgo={this.retornoSeleccionRiesgo}\n                                    configuracionHome={this.props.configuracionHome}\n                                    showUmbralHome={this.props.showUmbralHome}\n                                    riesgos={this.state.riesgos}\n                                    nombreRiesgo={this.state.nombreRiesgo}\n                                    pesoRiesgo={this.state.pesoRiesgo}\n                                    formulaRiesgo={this.state.formulaRiesgo}\n                                    idRiesgoSeleccionado={this.state.idRiesgoSeleccionado}> </EditarRiesgo>\n                </div>\n            );\n        }\n    }\n}\n"],"file":"RiesgoHome.js"}