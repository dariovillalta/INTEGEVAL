{"version":3,"sources":["components/Indicadores/SeleccionarIndicador.js"],"names":["SeleccionarIndicador","props","state","riesgos","indicadores","getIndicators","bind","insertIndicator","irCrearRiesgos","calcularPesoDisponible","transaction","sql","Transaction","pool","begin","err","rolledBack","on","aborted","request","Request","query","result","console","log","rollback","commit","setState","recordset","arregloTemp","i","length","ID","riesgoID","index","array","undefined","$","merge","updateBanderaCrearRiesgoTrue","showRiesgos","riesgo","indexRiesgo","pesoRiesgoTotal","pesoExistente","peso","pesoDisponible","goCrearIndicador","formula","configuracionHome","map","nombre","indicador","j","color","React","Component"],"mappings":";;;;;;;AAAA;;AACA;;AAEA;;;;;;;;;;;;;;;;;;;;;;IAEqBA,oB;;;;;AACjB,gCAAYC,KAAZ,EAAmB;AAAA;;AAAA;;AACf,8FAAMA,KAAN;AACA,UAAKC,KAAL,GAAa;AACTC,MAAAA,OAAO,EAAE,EADA;AAETC,MAAAA,WAAW,EAAE;AAFJ,KAAb;AAIA,UAAKC,aAAL,GAAqB,MAAKA,aAAL,CAAmBC,IAAnB,+BAArB;AACA,UAAKC,eAAL,GAAuB,MAAKA,eAAL,CAAqBD,IAArB,+BAAvB;AACA,UAAKE,cAAL,GAAsB,MAAKA,cAAL,CAAoBF,IAApB,+BAAtB;AACA,UAAKG,sBAAL,GAA8B,MAAKA,sBAAL,CAA4BH,IAA5B,+BAA9B;AATe;AAUlB;;;;wCAEmB;AAAA;;AAChB,UAAMI,WAAW,GAAG,IAAIC,kBAAIC,WAAR,CAAqB,KAAKX,KAAL,CAAWY,IAAhC,CAApB;AACAH,MAAAA,WAAW,CAACI,KAAZ,CAAkB,UAAAC,GAAG,EAAI;AACrB,YAAIC,UAAU,GAAG,KAAjB;AACAN,QAAAA,WAAW,CAACO,EAAZ,CAAe,UAAf,EAA2B,UAAAC,OAAO,EAAI;AAClCF,UAAAA,UAAU,GAAG,IAAb;AACH,SAFD;AAGA,YAAMG,OAAO,GAAG,IAAIR,kBAAIS,OAAR,CAAgBV,WAAhB,CAAhB;AACAS,QAAAA,OAAO,CAACE,KAAR,CAAc,uBAAd,EAAuC,UAACN,GAAD,EAAMO,MAAN,EAAiB;AACpD,cAAIP,GAAJ,EAAS;AACL,gBAAI,CAACC,UAAL,EAAiB;AACbO,cAAAA,OAAO,CAACC,GAAR,CAAYT,GAAZ;AACAL,cAAAA,WAAW,CAACe,QAAZ,CAAqB,UAAAV,GAAG,EAAI,CAC3B,CADD;AAEH;AACJ,WAND,MAMO;AACHL,YAAAA,WAAW,CAACgB,MAAZ,CAAmB,UAAAX,GAAG,EAAI;AACtB,cAAA,MAAI,CAACY,QAAL,CAAc;AACVxB,gBAAAA,OAAO,EAAEmB,MAAM,CAACM;AADN,eAAd;;AAGA,cAAA,MAAI,CAACvB,aAAL;AACH,aALD;AAMH;AACJ,SAfD;AAgBH,OAtBD,EAFgB,CAwBZ;AACP;;;oCAEe;AACZ,UAAIwB,WAAW,GAAG,EAAlB;;AACA,WAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAK5B,KAAL,CAAWC,OAAX,CAAmB4B,MAAvC,EAA+CD,CAAC,EAAhD,EAAoD;AAChD,aAAKvB,eAAL,CAAqB,KAAKL,KAAL,CAAWC,OAAX,CAAmB2B,CAAnB,EAAsBE,EAA3C,EAA+CF,CAA/C,EAAkDD,WAAlD;AACH;;AAAA;AACJ;;;oCAEeI,Q,EAAUC,K,EAAOC,K,EAAO;AAAA;;AACpC,UAAMzB,WAAW,GAAG,IAAIC,kBAAIC,WAAR,CAAqB,KAAKX,KAAL,CAAWY,IAAhC,CAApB;AACAH,MAAAA,WAAW,CAACI,KAAZ,CAAkB,UAAAC,GAAG,EAAI;AACrB,YAAIC,UAAU,GAAG,KAAjB;AACAN,QAAAA,WAAW,CAACO,EAAZ,CAAe,UAAf,EAA2B,UAAAC,OAAO,EAAI;AAClCF,UAAAA,UAAU,GAAG,IAAb;AACH,SAFD;AAGA,YAAMG,OAAO,GAAG,IAAIR,kBAAIS,OAAR,CAAgBV,WAAhB,CAAhB;AACAS,QAAAA,OAAO,CAACE,KAAR,CAAc,qDAAmDY,QAAjE,EAA2E,UAAClB,GAAD,EAAMO,MAAN,EAAiB;AACxF,cAAIP,GAAJ,EAAS;AACL,gBAAI,CAACC,UAAL,EAAiB;AACbO,cAAAA,OAAO,CAACC,GAAR,CAAYT,GAAZ;AACAL,cAAAA,WAAW,CAACe,QAAZ,CAAqB,UAAAV,GAAG,EAAI,CAC3B,CADD;AAEH;AACJ,WAND,MAMO;AACHL,YAAAA,WAAW,CAACgB,MAAZ,CAAmB,UAAAX,GAAG,EAAI;AACtB,kBAAGoB,KAAK,CAACD,KAAD,CAAL,IAAgBE,SAAnB,EAA8B;AAC1BD,gBAAAA,KAAK,CAACD,KAAD,CAAL,GAAe,EAAf;AACH;;AACDC,cAAAA,KAAK,CAACD,KAAD,CAAL,GAAeG,CAAC,CAACC,KAAF,CAAQH,KAAK,CAACD,KAAD,CAAb,EAAsBZ,MAAM,CAACM,SAA7B,CAAf;;AACA,cAAA,MAAI,CAACD,QAAL,CAAc;AACVvB,gBAAAA,WAAW,EAAE+B;AADH,eAAd;AAGH,aARD;AASH;AACJ,SAlBD;AAmBH,OAzBD,EAFoC,CA2BhC;AACP;;;qCAEiB;AACd,WAAKlC,KAAL,CAAWsC,4BAAX;AACA,WAAKtC,KAAL,CAAWuC,WAAX;AACH;;;2CAEuBC,M,EAAQC,W,EAAa;AACzC,UAAIC,eAAe,GAAG,GAAtB;AACA,UAAIC,aAAa,GAAG,CAApB;;AACA,WAAK,IAAId,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAK5B,KAAL,CAAWE,WAAX,CAAuBsC,WAAvB,EAAoCX,MAAxD,EAAgED,CAAC,EAAjE,EAAqE;AACjEP,QAAAA,OAAO,CAACC,GAAR,CAAY,SAAOM,CAAnB;AACAP,QAAAA,OAAO,CAACC,GAAR,CAAY,KAAKtB,KAAL,CAAWE,WAAX,CAAuBsC,WAAvB,EAAoCZ,CAApC,CAAZ;AACAc,QAAAA,aAAa,IAAI,KAAK1C,KAAL,CAAWE,WAAX,CAAuBsC,WAAvB,EAAoCZ,CAApC,EAAuCe,IAAxD;AACH;;AAAA;AACDtB,MAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYoB,aAAZ;AACArB,MAAAA,OAAO,CAACC,GAAR,CAAY,iBAAZ;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYmB,eAAZ;AACA,UAAIG,cAAc,GAAGH,eAAe,GAACC,aAArC;AACArB,MAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYsB,cAAZ;AACA,WAAK7C,KAAL,CAAW8C,gBAAX,CAA4BN,MAAM,CAACT,EAAnC,EAAuCS,MAAM,CAACO,OAA9C,EAAuDF,cAAvD;AACH;;;6BAEQ;AAAA;;AACL,aACI,6CACI;AAAK,QAAA,SAAS,EAAE;AAAhB,SACI;AAAK,QAAA,SAAS,EAAE;AAAhB,SACI;AAAK,QAAA,SAAS,EAAE;AAAhB,SACI;AAAI,QAAA,SAAS,EAAE;AAAf,8BADJ,EAEI;AAAK,QAAA,SAAS,EAAE;AAAhB,SACI;AAAK,sBAAW;AAAhB,SACI;AAAI,QAAA,SAAS,EAAE;AAAf,SACI;AAAI,QAAA,SAAS,EAAE,yBAAf;AAA0C,wBAAa,MAAvD;AAA8D,QAAA,OAAO,EAAE,KAAK7C,KAAL,CAAWgD;AAAlF,SAAqG;AAAG,QAAA,IAAI,EAAC,GAAR;AAAY,QAAA,SAAS,EAAE;AAAvB,4BAArG,CADJ,EAEI;AAAI,QAAA,SAAS,EAAE,gCAAf;AAAiD,wBAAa;AAA9D,8BAFJ,CADJ,CADJ,CAFJ,CADJ,CADJ,CADJ,EAgBI,2CAhBJ,EAiBI;AAAK,QAAA,SAAS,EAAE;AAAhB,SACI;AAAK,QAAA,SAAS,EAAE;AAAhB,SACK,KAAK/C,KAAL,CAAWC,OAAX,CAAmB+C,GAAnB,CAAuB,UAACT,MAAD,EAASX,CAAT;AAAA,eACpB;AAAK,UAAA,GAAG,EAAEW,MAAM,CAACT;AAAjB,WACI,gCAAC,qBAAD;AAAW,UAAA,SAAS,EAAE,KAAtB;AAA6B,UAAA,QAAQ,EAAE,KAAvC;AAA8C,UAAA,iBAAiB,MAA/D;AAAgE,UAAA,KAAK,EAAE;AAAvE,WACI;AAAK,UAAA,KAAK,EAAES,MAAM,CAACU;AAAnB,WACM,MAAI,CAACjD,KAAL,CAAWE,WAAX,CAAuB0B,CAAvB,KAA6BM,SAA7B,GACE,6CACK,MAAI,CAAClC,KAAL,CAAWE,WAAX,CAAuB0B,CAAvB,EAA0BoB,GAA1B,CAA8B,UAACE,SAAD,EAAYC,CAAZ;AAAA,iBAC3B;AAAG,YAAA,SAAS,EAAE,+DAAd;AAA+E,YAAA,GAAG,EAAED,SAAS,CAACpB;AAA9F,aAAmGoB,SAAS,CAACD,MAA7G,CAD2B;AAAA,SAA9B,CADL,EAII;AAAK,UAAA,SAAS,EAAE;AAAhB,WACI;AAAG,UAAA,SAAS,EAAE,gEAAd;AAAgF,UAAA,KAAK,EAAE;AAACG,YAAAA,KAAK,EAAE;AAAR,WAAvF;AAA2G,UAAA,OAAO,EAAE;AAAA,mBAAM,MAAI,CAAC7C,sBAAL,CAA4BgC,MAA5B,EAAoCX,CAApC,CAAN;AAAA;AAApH,6BADJ,CAJJ,CADF,GAUE,IAXR,CADJ,CADJ,EAiBI,2CAjBJ,CADoB;AAAA,OAAvB,CADL,EAsBM,KAAK5B,KAAL,CAAWC,OAAX,CAAmB4B,MAAnB,IAA6B,CAA7B,GACE;AAAG,QAAA,SAAS,EAAE,+DAAd;AAA+E,QAAA,OAAO,EAAE,KAAKvB;AAA7F,2DADF,GAGE,IAzBR,CADJ,CAjBJ,CADJ;AAkDH;;;;EAvJ6C+C,kBAAMC,S","sourcesContent":["import React from 'react';\nimport sql from 'mssql';\n\nimport Accordion from '../Accordion/Accordion.js';\n\nexport default class SeleccionarIndicador extends React.Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            riesgos: [],\n            indicadores: []\n        }\n        this.getIndicators = this.getIndicators.bind(this);\n        this.insertIndicator = this.insertIndicator.bind(this);\n        this.irCrearRiesgos = this.irCrearRiesgos.bind(this);\n        this.calcularPesoDisponible = this.calcularPesoDisponible.bind(this);\n    }\n\n    componentDidMount() {\n        const transaction = new sql.Transaction( this.props.pool );\n        transaction.begin(err => {\n            var rolledBack = false;\n            transaction.on('rollback', aborted => {\n                rolledBack = true;\n            });\n            const request = new sql.Request(transaction);\n            request.query(\"select * from Riesgos\", (err, result) => {\n                if (err) {\n                    if (!rolledBack) {\n                        console.log(err);\n                        transaction.rollback(err => {\n                        });\n                    }\n                } else {\n                    transaction.commit(err => {\n                        this.setState({\n                            riesgos: result.recordset\n                        });\n                        this.getIndicators();\n                    });\n                }\n            });\n        }); // fin transaction\n    }\n\n    getIndicators() {\n        var arregloTemp = [];\n        for (var i = 0; i < this.state.riesgos.length; i++) {\n            this.insertIndicator(this.state.riesgos[i].ID, i, arregloTemp);\n        };\n    }\n\n    insertIndicator(riesgoID, index, array) {\n        const transaction = new sql.Transaction( this.props.pool );\n        transaction.begin(err => {\n            var rolledBack = false;\n            transaction.on('rollback', aborted => {\n                rolledBack = true;\n            });\n            const request = new sql.Request(transaction);\n            request.query(\"select * from Indicadores where idRiesgoPadre = \"+riesgoID, (err, result) => {\n                if (err) {\n                    if (!rolledBack) {\n                        console.log(err);\n                        transaction.rollback(err => {\n                        });\n                    }\n                } else {\n                    transaction.commit(err => {\n                        if(array[index] == undefined) {\n                            array[index] = [];\n                        }\n                        array[index] = $.merge(array[index], result.recordset);\n                        this.setState({\n                            indicadores: array\n                        });\n                    });\n                }\n            });\n        }); // fin transaction\n    }\n\n    irCrearRiesgos () {\n        this.props.updateBanderaCrearRiesgoTrue();\n        this.props.showRiesgos();\n    }\n\n    calcularPesoDisponible (riesgo, indexRiesgo) {\n        var pesoRiesgoTotal = 100;\n        var pesoExistente = 0;\n        for (var i = 0; i < this.state.indicadores[indexRiesgo].length; i++) {\n            console.log('i = '+i);\n            console.log(this.state.indicadores[indexRiesgo][i]);\n            pesoExistente += this.state.indicadores[indexRiesgo][i].peso;\n        };\n        console.log('pesoExistente');\n        console.log(pesoExistente);\n        console.log('pesoRiesgoTotal');\n        console.log(pesoRiesgoTotal);\n        var pesoDisponible = pesoRiesgoTotal-pesoExistente\n        console.log('pesoDisponible');\n        console.log(pesoDisponible);\n        this.props.goCrearIndicador(riesgo.ID, riesgo.formula, pesoDisponible);\n    }\n\n    render() {\n        return (\n            <div>\n                <div className={\"row\"}>\n                    <div className={\"col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12\"}>\n                        <div className={\"page-header\"}>\n                            <h2 className={\"pageheader-title\"}>Seleccionar Riesgo</h2>\n                            <div className={\"page-breadcrumb\"}>\n                                <nav aria-label=\"breadcrumb\">\n                                    <ol className={\"breadcrumb\"}>\n                                        <li className={\"breadcrumb-item font-16\"} aria-current=\"page\" onClick={this.props.configuracionHome}><a href=\"#\" className={\"breadcrumb-link\"}>Configuraci&oacute;n</a></li>\n                                        <li className={\"breadcrumb-item active font-16\"} aria-current=\"page\">Seleccionar Riesgo</li>\n                                    </ol>\n                                </nav>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <br/>\n                <div className={\"row\"}>\n                    <div className={\"col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12\"}>\n                        {this.state.riesgos.map((riesgo, i) => (\n                            <div key={riesgo.ID}>\n                                <Accordion showTrash={false} showEdit={false} allowMultipleOpen color={\"#ffffff\"}>\n                                    <div label={riesgo.nombre}>\n                                        { this.state.indicadores[i] != undefined ? (\n                                            <div>\n                                                {this.state.indicadores[i].map((indicador, j) =>\n                                                    <a className={\"btn btn-outline-info btn-block btnWhiteColorHover fontSize1EM\"} key={indicador.ID}>{indicador.nombre}</a>\n                                                )}\n                                                <div className={\"row\"}>\n                                                    <a className={\"btn btn-success btn-block btnWhiteColorHover font-bold font-20\"} style={{color: \"#fafafa\"}} onClick={() => this.calcularPesoDisponible(riesgo, i)}>Crear Indicador</a>\n                                                </div>\n                                            </div>\n                                        ) : (\n                                            null\n                                        )}\n                                    </div>\n                                </Accordion>\n                                <br/>\n                            </div>\n                        ))}\n                        { this.state.riesgos.length == 0 ? (\n                            <a className={\"btn btn-outline-dark btn-block btnWhiteColorHover fontSize1EM\"} onClick={this.irCrearRiesgos}>No existen riesgos creados, presione para crear</a>\n                        ) : (\n                            null\n                        )}\n                    </div>\n                </div>\n            </div>\n        );\n    }\n}\n"],"file":"SeleccionarIndicador.js"}